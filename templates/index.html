<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Ödeme Takip</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
        padding-top: 70px;
      }
      .grafik {
        max-width: 100%;
        height: auto;
        margin-top: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .nav-link.active {
        font-weight: bold;
        color: #0d6efd !important;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">💰 Ödeme Takip</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/toptanci-listesi">Toptancılar</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/odeme-listesi">Ödemeler</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/toptanci-ekle">Toptancı Ekle</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/odeme-ekle">Ödeme Ekle</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/rapor">Raporlama</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/urun-ekle">Ürün Ekle</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/urun-listesi">Ürünler</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-danger" href="/cikis">Çıkış</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <h2 class="mb-4">📊 Genel Durum</h2>
      <div class="row g-3">
        <div class="col-md-4">
          <div class="card text-bg-primary">
            <div class="card-body">
              <h5 class="card-title">Toptancı Sayısı</h5>
              <p class="card-text">{{ toptanci_sayisi }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-bg-success">
            <div class="card-body">
              <h5 class="card-title">Toplam Ödeme</h5>
              <p class="card-text">{{ toplam_odeme }} ₺</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-bg-warning">
            <div class="card-body">
              <h5 class="card-title">Son Ödeme Tarihi</h5>
              <p class="card-text">{{ son_odeme_tarihi }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="text-center mt-5">
        <img
          src="{{ url_for('static', filename='grafikler/borc_grafigi.png') }}"
          alt="Borç Grafiği"
          class="grafik"
        />
      </div>

      <div class="mt-4 text-center">
        {% if session.get('yetki') == 'admin' %}
        <p class="text-success">
          👑 Hoş geldin Admin <strong>{{ session['kullanici'] }}</strong>
        </p>
        {% else %}
        <p class="text-primary">
          👋 Hoş geldin <strong>{{ session['kullanici'] }}</strong>
        </p>
        {% endif %}
      </div>

      <div class="text-center mt-3">
        <a href="/cikis" class="btn btn-outline-danger">Çıkış Yap</a>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Ekstra JS: Canlı Saat -->
    <script>
      const saatDiv = document.createElement("div");
      saatDiv.className = "text-center text-muted mt-3";
      document.body.appendChild(saatDiv);

      function saatGuncelle() {
        const simdi = new Date();
        saatDiv.textContent = "📅 " + simdi.toLocaleString("tr-TR");
      }
      setInterval(saatGuncelle, 1000);
    </script>
    <script>
      // 1. Canlı saat
      const saatDiv = document.createElement("div");
      saatDiv.className = "text-center text-muted mt-3";
      document.body.appendChild(saatDiv);

      function saatGuncelle() {
        const simdi = new Date();
        saatDiv.textContent = "📅 " + simdi.toLocaleString("tr-TR");
      }
      setInterval(saatGuncelle, 1000);

      // 2. Sayfa içi arama (liste varsa filtreleme için)
      const aramaInput = document.createElement("input");
      aramaInput.className = "form-control my-3";
      aramaInput.placeholder = "🔍 Toptancı veya ödeme ara...";
      document.querySelector(".container")?.prepend(aramaInput);

      aramaInput.addEventListener("input", () => {
        const filtre = aramaInput.value.toLowerCase();
        document.querySelectorAll("li").forEach((li) => {
          li.style.display = li.textContent.toLowerCase().includes(filtre)
            ? ""
            : "none";
        });
      });

      // 3. Grafik büyütme
      const grafik = document.querySelector("img.grafik");
      grafik?.addEventListener("click", () => {
        grafik.style.transform = "scale(1.2)";
        grafik.style.transition = "transform 0.3s ease";
        setTimeout(() => {
          grafik.style.transform = "scale(1)";
        }, 1500);
      });

      // 4. Koyu mod geçişi
      const koyuModBtn = document.createElement("button");
      koyuModBtn.textContent = "🌙 Koyu Mod";
      koyuModBtn.className = "btn btn-outline-dark btn-sm d-block mx-auto mt-3";
      document.body.appendChild(koyuModBtn);

      koyuModBtn.addEventListener("click", () => {
        document.body.classList.toggle("bg-dark");
        document.body.classList.toggle("text-light");
      });
    </script>
  </body>
</html>
